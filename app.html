<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamKitX - Web App</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <meta name="theme-color" content="#CCFF00">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(
                135deg,
                rgb(13, 13, 20) 0%,
                rgb(20, 30, 13) 50%,
                rgb(5, 5, 5) 100%
            );
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background Glows */
        .background-glow {
            position: fixed;
            pointer-events: none;
            z-index: 0;
        }

        .glow-1 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(204, 255, 0, 0.15) 0%, rgba(204, 255, 0, 0.05) 50%, transparent 100%);
            filter: blur(40px);
            top: 15%;
            left: 20%;
        }

        .glow-2 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(204, 255, 0, 0.1) 0%, rgba(204, 255, 0, 0.03) 50%, transparent 100%);
            filter: blur(50px);
            bottom: 30%;
            right: 20%;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ============ LOGIN SCREEN ============ */
        #login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(204, 255, 0, 0.2);
            border-radius: 20px;
            padding: 60px 50px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo h1 {
            font-size: 2.5rem;
            font-weight: 800;
            color: #CCFF00;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        .login-logo p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: rgba(128, 128, 128, 0.2);
            border: 1px solid rgba(204, 255, 0, 0.3);
            border-radius: 10px;
            padding: 12px 16px;
            transition: all 0.3s ease;
        }

        .input-wrapper:focus-within {
            border-color: rgba(204, 255, 0, 0.6);
            background: rgba(128, 128, 128, 0.25);
        }

        .input-icon {
            color: #CCFF00;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .form-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: white;
            font-size: 1rem;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .password-toggle {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 4px 8px;
            transition: color 0.3s ease;
        }

        .password-toggle:hover {
            color: #CCFF00;
        }

        .forgot-password {
            text-align: right;
            margin-top: 8px;
        }

        .forgot-password a {
            color: #CCFF00;
            text-decoration: none;
            font-size: 0.9rem;
            transition: opacity 0.3s ease;
        }

        .forgot-password a:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: #CCFF00;
            color: black;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(204, 255, 0, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .cross-app-note {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cross-app-note p {
            color: #CCFF00;
            font-size: 0.85rem;
        }

        .error-message {
            background: rgba(255, 59, 48, 0.2);
            border: 1px solid rgba(255, 59, 48, 0.4);
            color: #FF3B30;
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            text-align: center;
        }

        /* ============ DASHBOARD ============ */
        #dashboard {
            display: none;
            min-height: 100vh;
            padding: 20px 0;
        }

        /* Header */
        .dashboard-header {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(204, 255, 0, 0.2);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 1.8rem;
            color: #CCFF00;
            margin-bottom: 4px;
        }

        .header-left p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(204, 255, 0, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(204, 255, 0, 0.2);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #CCFF00;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            font-size: 1.1rem;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .user-email {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .premium-badge {
            display: inline-block;
            background: linear-gradient(135deg, #CCFF00 0%, #99CC00 100%);
            color: #1a1a1a;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 8px;
            box-shadow: 0 2px 8px rgba(204, 255, 0, 0.3);
        }

        .free-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .btn-create {
            background: linear-gradient(135deg, #CCFF00 0%, #99CC00 100%);
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-create:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(204, 255, 0, 0.4);
        }

        .btn-create:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #CCFF00;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(204, 255, 0, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #CCFF00;
            background: rgba(255, 255, 255, 0.08);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .limit-warning {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            color: #FFA500;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .limit-warning strong {
            color: #FFD700;
        }

        .btn-submit {
            background: linear-gradient(135deg, #CCFF00 0%, #99CC00 100%);
            color: #1a1a1a;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 8px;
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(204, 255, 0, 0.4);
        }

        .btn-submit:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
        }

        .btn-logout {
            padding: 10px 20px;
            background: transparent;
            border: 2px solid rgba(204, 255, 0, 0.3);
            color: #CCFF00;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: rgba(204, 255, 0, 0.1);
            border-color: #CCFF00;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(204, 255, 0, 0.2);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: rgba(204, 255, 0, 0.4);
            box-shadow: 0 10px 30px rgba(204, 255, 0, 0.1);
        }

        .stat-card[onclick] {
            cursor: pointer;
        }

        .stat-card[onclick]:hover {
            border-color: rgba(204, 255, 0, 0.6);
            box-shadow: 0 15px 40px rgba(204, 255, 0, 0.2);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: rgba(204, 255, 0, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: #CCFF00;
            margin-bottom: 4px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Inventory Section */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 20px;
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: white;
        }

        .btn-add {
            padding: 12px 24px;
            background: #CCFF00;
            color: black;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(204, 255, 0, 0.3);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .inventory-card {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(204, 255, 0, 0.2);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .inventory-card:hover {
            transform: translateY(-4px);
            border-color: rgba(204, 255, 0, 0.4);
            box-shadow: 0 10px 30px rgba(204, 255, 0, 0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .item-type {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .item-id {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .item-badges {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
        }

        .item-number-badge {
            display: inline-block;
            padding: 4px 12px;
            background: #CCFF00;
            color: black;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .item-size-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .item-condition {
            padding: 6px 12px;
            background: rgba(204, 255, 0, 0.2);
            color: #CCFF00;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .item-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .item-detail {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .detail-value {
            font-size: 0.95rem;
            font-weight: 600;
            color: white;
        }

        /* Color Bubble */
        .color-bubble {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .color-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .color-dot + .color-dot {
            margin-left: -8px; /* Overlap multiple dots slightly */
        }

        .color-name {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .item-badges .color-dot {
            width: 20px;
            height: 20px;
        }

        .item-badges .color-dot + .color-dot {
            margin-left: -6px; /* Overlap for badge dots */
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(204, 255, 0, 0.2);
            border-top-color: #CCFF00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.1rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .empty-subtext {
            color: rgba(255, 255, 255, 0.4);
        }

        /* Debug Panel */
        .debug-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 59, 48, 0.9);
            color: white;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            font-size: 0.85rem;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .debug-panel h4 {
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .debug-panel pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.75rem;
        }

        .debug-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
        }

        .debug-close:hover {
            opacity: 1;
        }

        /* Members Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(204, 255, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            color: #CCFF00;
        }

        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
        }

        .member-card {
            background: rgba(40, 40, 40, 0.6);
            border: 1px solid rgba(204, 255, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .member-card:hover {
            transform: translateY(-2px);
            border-color: rgba(204, 255, 0, 0.4);
        }

        .member-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .member-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #CCFF00;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            font-size: 1.2rem;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 600;
            color: white;
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .member-role {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(204, 255, 0, 0.2);
            color: #CCFF00;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .member-email {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 8px;
        }

        /* Filter Bar */
        .filter-bar {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(204, 255, 0, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filter-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }

        .clear-filters-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(204, 255, 0, 0.3);
            color: #CCFF00;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .clear-filters-btn:hover {
            background: rgba(204, 255, 0, 0.1);
            border-color: #CCFF00;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(204, 255, 0, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #CCFF00;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(204, 255, 0, 0.1);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #CCFF00;
            font-size: 1.2rem;
            pointer-events: none;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .filter-dropdown {
            position: relative;
        }

        .filter-select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(204, 255, 0, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23CCFF00' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #CCFF00;
            background-color: rgba(255, 255, 255, 0.08);
        }

        .filter-select option {
            background: #1A1A1A;
            color: white;
            padding: 10px;
        }

        .quick-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-filter-chip {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(204, 255, 0, 0.3);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .quick-filter-chip:hover {
            background: rgba(204, 255, 0, 0.1);
            border-color: #CCFF00;
            color: white;
        }

        .quick-filter-chip.active {
            background: #CCFF00;
            color: black;
            border-color: #CCFF00;
            font-weight: 600;
        }

        .quick-filter-chip .emoji {
            font-size: 1rem;
        }

        .active-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .active-filter-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(204, 255, 0, 0.2);
            border: 1px solid rgba(204, 255, 0, 0.4);
            border-radius: 16px;
            color: #CCFF00;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .remove-filter {
            background: none;
            border: none;
            color: #CCFF00;
            cursor: pointer;
            font-size: 1.1rem;
            line-height: 1;
            padding: 0;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .remove-filter:hover {
            background: rgba(204, 255, 0, 0.3);
        }

        .filter-results {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-top: 12px;
        }

        .filter-results strong {
            color: #CCFF00;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .filters-grid {
                grid-template-columns: 1fr;
            }

            .filter-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .login-container {
                padding: 40px 30px;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .inventory-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Background Glows -->
    <div class="background-glow glow-1"></div>
    <div class="background-glow glow-2"></div>

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel" style="display: none;">
        <button class="debug-close" onclick="document.getElementById('debug-panel').style.display='none'">√ó</button>
        <h4>üîç Debug Info</h4>
        <div id="debug-content"></div>
    </div>

    <!-- Members Modal -->
    <div id="members-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë• Team Members</h2>
                <button class="modal-close" onclick="closeMembersModal()">√ó</button>
            </div>
            <div id="members-list" class="members-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading members...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="add-item-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Add New Item</h2>
                <button class="modal-close" onclick="closeAddItemModal()">√ó</button>
            </div>
            <div id="item-limit-warning" class="limit-warning" style="display: none;">
                <span>‚ö†Ô∏è</span>
                <div>
                    <strong>Free Tier Limit Reached!</strong>
                    <p>You have <span id="current-item-count">0</span> items. Free tier allows up to 50 items. Upgrade to Premium for unlimited items.</p>
                </div>
            </div>
            <form id="add-item-form" onsubmit="handleAddItem(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="item-type">Item Type</label>
                        <select id="item-type" required>
                            <option value="">Select type...</option>
                            <optgroup label="Game Kits">
                                <option value="jersey">üëï Jersey</option>
                                <option value="shorts">ü©≥ Shorts</option>
                                <option value="socks">üß¶ Socks</option>
                            </optgroup>
                            <optgroup label="Training">
                                <option value="training_shirt">üèÉ Training Shirt</option>
                                <option value="bibs">üü¶ Training Bibs</option>
                                <option value="tracksuit">üß• Tracksuit</option>
                                <option value="balls">‚öΩ Balls</option>
                                <option value="cones">üî∂ Cones</option>
                            </optgroup>
                            <optgroup label="Goalkeeper">
                                <option value="goalkeeping_kit">ü•Ö Goalkeeping Kit</option>
                                <option value="gloves">üß§ Gloves</option>
                            </optgroup>
                            <optgroup label="Equipment & Accessories">
                                <option value="boots">üëü Boots</option>
                                <option value="protective_gear">üõ°Ô∏è Protective Gear</option>
                            </optgroup>
                            <optgroup label="Other">
                                <option value="other">üì¶ Other</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="item-number">Number (optional)</label>
                        <input type="number" id="item-number" placeholder="e.g., 10" min="0" max="999">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="item-size">Size</label>
                        <select id="item-size" required>
                            <option value="one_size">One Size</option>
                            <option value="XS">XS</option>
                            <option value="S">S</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XXL">XXL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="item-color">Color</label>
                        <select id="item-color" required>
                            <option value="#FF0000">üî¥ Red</option>
                            <option value="#0000FF">üîµ Blue</option>
                            <option value="#00FF00">üü¢ Green</option>
                            <option value="#FFFF00">üü° Yellow</option>
                            <option value="#000000">‚ö´ Black</option>
                            <option value="#FFFFFF">‚ö™ White</option>
                            <option value="#FFA500">üü† Orange</option>
                            <option value="#800080">üü£ Purple</option>
                        </select>
                    </div>
                </div>
                <!-- Purchase Information -->
                <div style="margin-top: 24px; margin-bottom: 8px; border-top: 1px solid rgba(204, 255, 0, 0.2); padding-top: 20px;">
                    <h3 style="color: #CCFF00; font-size: 0.95rem; margin-bottom: 16px;">üí∞ Purchase Information</h3>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="item-purchase-price">Purchase Price (optional)</label>
                        <input type="number" id="item-purchase-price" placeholder="0.00" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="item-supplier">Supplier</label>
                        <select id="item-supplier">
                            <option value="Nike">Nike</option>
                            <option value="Adidas">Adidas</option>
                            <option value="Puma">Puma</option>
                            <option value="Under Armour">Under Armour</option>
                            <option value="New Balance">New Balance</option>
                            <option value="Umbro">Umbro</option>
                            <option value="Kappa">Kappa</option>
                            <option value="Joma">Joma</option>
                            <option value="Macron">Macron</option>
                            <option value="Errea">Errea</option>
                            <option value="Jako">Jako</option>
                            <option value="Hummel">Hummel</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <!-- Identification -->
                <div style="margin-top: 24px; margin-bottom: 8px; border-top: 1px solid rgba(204, 255, 0, 0.2); padding-top: 20px;">
                    <h3 style="color: #CCFF00; font-size: 0.95rem; margin-bottom: 16px;">üîñ Identification</h3>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="item-season">Season (optional)</label>
                        <input type="text" id="item-season" placeholder="e.g., 2024/25">
                    </div>
                    <div class="form-group">
                        <label for="item-unique-id">Custom ID (optional)</label>
                        <input type="text" id="item-unique-id" placeholder="Leave blank for auto-generation">
                        <small style="color: rgba(255,255,255,0.6); display: block; margin-top: 4px; font-size: 0.75rem;">
                            Auto-generated if empty
                        </small>
                    </div>
                </div>

                <!-- Status & Location -->
                <div style="margin-top: 24px; margin-bottom: 8px; border-top: 1px solid rgba(204, 255, 0, 0.2); padding-top: 20px;">
                    <h3 style="color: #CCFF00; font-size: 0.95rem; margin-bottom: 16px;">üìç Status & Location</h3>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="item-condition">Condition</label>
                        <select id="item-condition" required>
                            <option value="new">‚ú® New</option>
                            <option value="excellent">üíö Excellent</option>
                            <option value="good">üëç Good</option>
                            <option value="fair">‚ö†Ô∏è Fair</option>
                            <option value="poor">üî¥ Poor</option>
                            <option value="damaged">üíî Damaged</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="item-location">Location</label>
                        <select id="item-location">
                            <option value="storage">üè† Storage</option>
                            <option value="with_player">üë§ With Player</option>
                            <option value="being_washed">üíß Being Washed</option>
                            <option value="being_repaired">üîß Being Repaired</option>
                            <option value="in_transit">üöö In Transit</option>
                        </select>
                    </div>
                </div>

                <!-- Notes -->
                <div style="margin-top: 24px; margin-bottom: 8px; border-top: 1px solid rgba(204, 255, 0, 0.2); padding-top: 20px;">
                    <h3 style="color: #CCFF00; font-size: 0.95rem; margin-bottom: 16px;">üìù Notes</h3>
                </div>
                <div class="form-group">
                    <label for="item-notes">Additional Notes (optional)</label>
                    <textarea id="item-notes" placeholder="Any additional information about this item..."></textarea>
                </div>
                <button type="submit" class="btn-submit" id="submit-item-btn">Add Item</button>
            </form>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div id="add-member-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ Add Team Member</h2>
                <button class="modal-close" onclick="closeAddMemberModal()">√ó</button>
            </div>
            <div id="member-limit-warning" class="limit-warning" style="display: none;">
                <span>‚ö†Ô∏è</span>
                <div>
                    <strong>Free Tier Limit Reached!</strong>
                    <p>You have <span id="current-member-count">0</span> members. Free tier allows up to 15 members. Upgrade to Premium for unlimited members.</p>
                </div>
            </div>
            <form id="add-member-form" onsubmit="handleAddMember(event)">
                <div class="form-group">
                    <label for="member-name">Full Name</label>
                    <input type="text" id="member-name" required placeholder="Enter member name">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="member-email">Email</label>
                        <input type="email" id="member-email" required placeholder="member@example.com">
                    </div>
                    <div class="form-group">
                        <label for="member-role">Role</label>
                        <select id="member-role" required>
                            <option value="player">üèÉ Player</option>
                            <option value="coach">üë®‚Äçüè´ Coach</option>
                            <option value="assistant">ü§ù Assistant</option>
                            <option value="manager">üíº Manager</option>
                            <option value="physio">üè• Physio</option>
                            <option value="doctor">‚öïÔ∏è Doctor</option>
                            <option value="analyst">üìä Analyst</option>
                            <option value="nutritionist">ü•ó Nutritionist</option>
                            <option value="admin">‚öôÔ∏è Admin</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="member-number">Player Number (optional)</label>
                    <input type="number" id="member-number" placeholder="e.g., 10">
                </div>
                <button type="submit" class="btn-submit" id="submit-member-btn">Add Member</button>
            </form>
        </div>
    </div>

    <!-- Create Assignment Modal -->
    <div id="create-assignment-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîÑ Create Assignment</h2>
                <button class="modal-close" onclick="closeCreateAssignmentModal()">√ó</button>
            </div>
            <div id="assignment-limit-warning" class="limit-warning" style="display: none;">
                <span>‚ö†Ô∏è</span>
                <div>
                    <strong>Free Tier Limit Reached!</strong>
                    <p>You have <span id="current-assignment-count">0</span> assignments. Free tier allows up to 10 active assignments. Upgrade to Premium for unlimited assignments.</p>
                </div>
            </div>
            <form id="create-assignment-form" onsubmit="handleCreateAssignment(event)">
                <div class="form-group">
                    <label for="assignment-item">Select Item</label>
                    <select id="assignment-item" required>
                        <option value="">Choose an item...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignment-member">Assign To</label>
                    <select id="assignment-member" required>
                        <option value="">Choose a member...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignment-notes">Notes (optional)</label>
                    <textarea id="assignment-notes" placeholder="Reason for assignment or additional info..."></textarea>
                </div>
                <button type="submit" class="btn-submit" id="submit-assignment-btn">Create Assignment</button>
            </form>
        </div>
    </div>

    <!-- Create Numbered Set Modal (Premium Feature) -->
    <div id="numbered-set-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üî¢ Create Numbered Set <span style="color: #CCFF00; font-size: 0.8em;">üëë Premium</span></h2>
                <button class="modal-close" onclick="closeNumberedSetModal()">√ó</button>
            </div>
            <div id="numbered-set-premium-warning" class="limit-warning" style="display: none;">
                <span>üëë</span>
                <div>
                    <strong>Premium Feature Only!</strong>
                    <p>Numbered Set Creator is a Premium feature. Upgrade to create multiple numbered items at once (e.g., Jerseys #1-25).</p>
                </div>
            </div>
            <form id="numbered-set-form" onsubmit="handleCreateNumberedSet(event)">
                <!-- Item Type & Category -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="set-item-type">Item Type</label>
                        <select id="set-item-type" required>
                            <option value="">Select type...</option>
                            <option value="jersey">üëï Jersey</option>
                            <option value="shorts">ü©≥ Shorts</option>
                            <option value="socks">üß¶ Socks</option>
                            <option value="training_shirt">üèÉ Training Shirt</option>
                            <option value="bibs">üü¶ Training Bibs</option>
                            <option value="gloves">üß§ Gloves</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="set-numbering-mode">Numbering Mode</label>
                        <select id="set-numbering-mode" onchange="updateNumberingMode()" required>
                            <option value="sequential">üìä Sequential (e.g., 1-25)</option>
                            <option value="custom">‚úèÔ∏è Custom Numbers (e.g., 1,7,10,23)</option>
                        </select>
                    </div>
                </div>

                <!-- Sequential Mode -->
                <div id="sequential-mode" class="form-row">
                    <div class="form-group">
                        <label for="set-start-number">Start Number</label>
                        <input type="number" id="set-start-number" value="1" min="0" max="999" required>
                    </div>
                    <div class="form-group">
                        <label for="set-end-number">End Number</label>
                        <input type="number" id="set-end-number" value="25" min="0" max="999" required>
                    </div>
                </div>

                <!-- Custom Mode -->
                <div id="custom-mode" class="form-group" style="display: none;">
                    <label for="set-custom-numbers">Custom Numbers (comma-separated)</label>
                    <input type="text" id="set-custom-numbers" placeholder="e.g., 1,7,10,23,99">
                    <small style="color: rgba(255,255,255,0.6); display: block; margin-top: 4px;">
                        Enter numbers separated by commas
                    </small>
                </div>

                <!-- Common Attributes -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="set-size">Size</label>
                        <select id="set-size" required>
                            <option value="XS">XS</option>
                            <option value="S">S</option>
                            <option value="M" selected>M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XXL">XXL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="set-color">Color</label>
                        <select id="set-color" required>
                            <option value="#FF0000">üî¥ Red</option>
                            <option value="#0000FF">üîµ Blue</option>
                            <option value="#00FF00">üü¢ Green</option>
                            <option value="#FFFF00">üü° Yellow</option>
                            <option value="#000000">‚ö´ Black</option>
                            <option value="#FFFFFF">‚ö™ White</option>
                            <option value="#FFA500">üü† Orange</option>
                            <option value="#800080">üü£ Purple</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="set-condition">Condition</label>
                        <select id="set-condition" required>
                            <option value="new" selected>‚ú® New</option>
                            <option value="excellent">üíö Excellent</option>
                            <option value="good">üëç Good</option>
                            <option value="fair">‚ö†Ô∏è Fair</option>
                            <option value="poor">üî¥ Poor</option>
                            <option value="damaged">üíî Damaged</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="set-location">Location</label>
                        <select id="set-location">
                            <option value="storage">üè† Storage</option>
                            <option value="with_player">üë§ With Player</option>
                            <option value="being_washed">üíß Being Washed</option>
                            <option value="being_repaired">üîß Being Repaired</option>
                            <option value="in_transit">üöö In Transit</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="set-season">Season (optional)</label>
                        <input type="text" id="set-season" placeholder="e.g., 2024/25">
                    </div>
                    <div class="form-group">
                        <label for="set-supplier">Supplier</label>
                        <select id="set-supplier">
                            <option value="Nike">Nike</option>
                            <option value="Adidas">Adidas</option>
                            <option value="Puma">Puma</option>
                            <option value="Under Armour">Under Armour</option>
                            <option value="New Balance">New Balance</option>
                            <option value="Umbro">Umbro</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="set-notes">Notes (optional)</label>
                    <textarea id="set-notes" placeholder="Additional information for all items..."></textarea>
                </div>

                <!-- Item Count Preview -->
                <div style="background: rgba(204, 255, 0, 0.1); border: 1px solid rgba(204, 255, 0, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 20px;">
                    <strong style="color: #CCFF00;">Items to create: <span id="set-item-count">25</span></strong>
                </div>

                <button type="submit" class="btn-submit" id="submit-numbered-set-btn">Create Numbered Set</button>
            </form>
        </div>
    </div>

    <!-- ============ LOGIN SCREEN ============ -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <h1>TeamKitX</h1>
                <p>Kit Inventory Management Made Easy</p>
            </div>

            <div id="login-error" class="error-message" style="display: none;"></div>

            <form id="login-form">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <div class="input-wrapper">
                        <span class="input-icon">‚úâÔ∏è</span>
                        <input 
                            type="email" 
                            id="email" 
                            class="form-input" 
                            placeholder="Enter your email address"
                            required
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üîí</span>
                        <input 
                            type="password" 
                            id="password" 
                            class="form-input" 
                            placeholder="Enter your password"
                            required
                        >
                        <button type="button" class="password-toggle" id="toggle-password">üëÅÔ∏è</button>
                    </div>
                    <div class="forgot-password">
                        <a href="#" id="forgot-password-link">Forgot Password?</a>
                    </div>
                </div>

                <button type="submit" class="btn-primary" id="login-btn">
                    Sign In
                </button>
            </form>

            <div class="cross-app-note">
                <p>üí° Use your TeamKitX or TeamWalletX credentials</p>
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD ============ -->
    <div id="dashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="header-content">
                    <div class="header-left">
                        <h1>TeamKitX Dashboard</h1>
                        <p id="team-name">Loading...</p>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-avatar" id="user-avatar">U</div>
                            <div class="user-details">
                                <div class="user-name" id="user-name">Loading...</div>
                                <div class="user-email">
                                    <span id="user-email">Loading...</span>
                                    <span id="premium-badge"></span>
                                </div>
                            </div>
                        </div>
                        <button class="btn-logout" id="logout-btn">Logout</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-value" id="total-items">0</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="available-items">0</div>
                    <div class="stat-label">Available</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üîÑ</div>
                    <div class="stat-value" id="assigned-items">0</div>
                    <div class="stat-label">Assigned</div>
                </div>
                <div class="stat-card" onclick="showMembersModal()" style="cursor: pointer;">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="total-members">0</div>
                    <div class="stat-label">Team Members</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-create" id="btn-add-item" onclick="showAddItemModal()">
                    <span>‚ûï</span>
                    <span>Add New Item</span>
                </button>
                <button class="btn-create" id="btn-create-numbered-set" onclick="showNumberedSetModal()" title="Premium Feature">
                    <span>üî¢</span>
                    <span>Create Numbered Set</span>
                    <span style="font-size: 0.7em;">üëë</span>
                </button>
                <button class="btn-create" id="btn-add-member" onclick="showAddMemberModal()">
                    <span>üë§</span>
                    <span>Add Team Member</span>
                </button>
                <button class="btn-create" id="btn-create-assignment" onclick="showCreateAssignmentModal()">
                    <span>üîÑ</span>
                    <span>Create Assignment</span>
                </button>
            </div>

            <!-- Inventory Section -->
            <div class="section-header">
                <h2>Inventory</h2>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar" id="filter-bar" style="display: none;">
                <div class="filter-header">
                    <div class="filter-title">üîç Filter Items</div>
                    <button class="clear-filters-btn" onclick="clearAllFilters()">Clear All</button>
                </div>

                <!-- Search Box -->
                <div class="search-box">
                    <span class="search-icon">üîé</span>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="search-input"
                        placeholder="Search by ID, type, or color..."
                        oninput="applyFilters()"
                    >
                </div>

                <!-- Dropdown Filters -->
                <div class="filters-grid">
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-category" onchange="applyFilters()">
                            <option value="">All Categories</option>
                            <option value="Game Kits">üëï Game Kits</option>
                            <option value="Training">üèÉ Training</option>
                            <option value="Goalkeeper">ü•Ö Goalkeeper</option>
                            <option value="Equipment">‚öΩ Equipment</option>
                            <option value="Accessories">üéí Accessories</option>
                            <option value="Other">üì¶ Other</option>
                        </select>
                    </div>
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-type" onchange="applyFilters()">
                            <option value="">All Item Types</option>
                        </select>
                    </div>
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-number" onchange="applyFilters()">
                            <option value="">All Numbers (#)</option>
                        </select>
                    </div>
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-size" onchange="applyFilters()">
                            <option value="">All Sizes</option>
                        </select>
                    </div>
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-color" onchange="applyFilters()">
                            <option value="">All Colors</option>
                        </select>
                    </div>
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-season" onchange="applyFilters()">
                            <option value="">All Seasons</option>
                        </select>
                    </div>
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-condition" onchange="applyFilters()">
                            <option value="">All Conditions</option>
                            <option value="new">‚ú® New</option>
                            <option value="excellent">üíö Excellent</option>
                            <option value="good">üëç Good</option>
                            <option value="fair">‚ö†Ô∏è Fair</option>
                            <option value="poor">üî¥ Poor</option>
                            <option value="damaged">üíî Damaged</option>
                            <option value="beyond_repair">‚ùå Beyond Repair</option>
                        </select>
                    </div>
                    <div class="filter-dropdown">
                        <select class="filter-select" id="filter-location" onchange="applyFilters()">
                            <option value="">All Locations</option>
                            <option value="storage">üè† Storage</option>
                            <option value="with_player">üë§ With Player</option>
                            <option value="being_washed">üíß Being Washed</option>
                            <option value="being_repaired">üîß Being Repaired</option>
                            <option value="in_transit">üöö In Transit</option>
                            <option value="lost">‚ùå Lost</option>
                            <option value="disposed">üóëÔ∏è Disposed</option>
                        </select>
                    </div>
                </div>

                <!-- Quick Filters -->
                <div class="quick-filters">
                    <div class="quick-filter-chip" onclick="toggleQuickFilter('new')">
                        <span class="emoji">‚ú®</span> New Items
                    </div>
                    <div class="quick-filter-chip" onclick="toggleQuickFilter('storage')">
                        <span class="emoji">üè†</span> In Storage
                    </div>
                    <div class="quick-filter-chip" onclick="toggleQuickFilter('with_player')">
                        <span class="emoji">üë§</span> Assigned
                    </div>
                </div>

                <!-- Active Filters Display -->
                <div id="active-filters" class="active-filters" style="display: none;"></div>

                <!-- Filter Results Counter -->
                <div id="filter-results" class="filter-results"></div>
            </div>

            <div id="loading-inventory" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading your inventory...</div>
            </div>

            <div id="empty-inventory" class="empty-state" style="display: none;">
                <div class="empty-icon">üì¶</div>
                <div class="empty-text">No items yet</div>
                <div class="empty-subtext">Add items using the TeamKitX mobile app</div>
            </div>

            <div id="inventory-list" class="inventory-grid"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // NOTE: These API keys are PUBLIC by design and safe to expose!
        // - Firebase web API keys are meant to be visible in client code
        // - Real security comes from Firestore Security Rules (server-side)
        // - The API key only identifies your Firebase project
        // 
        // üîí TO SECURE FURTHER (Recommended):
        // 1. Go to Google Cloud Console: https://console.cloud.google.com/apis/credentials?project=teamwalletx
        // 2. Find "Browser key (auto created by Firebase)"
        // 3. Add domain restrictions: https://teamkitx.app/* and http://localhost/*
        // 4. Now the key only works on your domain!
        // ============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyDkz9qUU4aAg_W8LrRjpElHEoS5pUxKMT8",
            authDomain: "teamwalletx.firebaseapp.com",
            projectId: "teamwalletx",
            storageBucket: "teamwalletx.firebasestorage.app",
            messagingSenderId: "759222037573",
            appId: "1:759222037573:ios:0d7215e6f8276b2fe1472c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Test Firebase connection
        console.log('üî• Firebase initialized successfully');
        console.log('üî• Project ID:', firebaseConfig.projectId);
        console.log('üî• Auth Domain:', firebaseConfig.authDomain);

        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const togglePassword = document.getElementById('toggle-password');
        const passwordInput = document.getElementById('password');

        // User Data
        let currentUser = null;
        let userTeamId = null;
        let customItemTypes = {}; // Cache for custom item types (name mapping)
        let customItemTypeCategories = {}; // Cache for custom item type categories
        let teamMembers = []; // Store team members
        let allItems = []; // Store all inventory items for filtering
        let activeFilters = {
            search: '',
            category: '',
            type: '',
            number: '',
            size: '',
            color: '',
            season: '',
            condition: '',
            location: ''
        };

        // Subscription & Premium Status
        let isPremium = false;
        let currentItemCount = 0;
        let currentMemberCount = 0;
        let currentAssignmentCount = 0;
        const FREE_TIER_LIMITS = {
            items: 50,
            members: 15,
            assignments: 10
        };

        // ============ UTILITY FUNCTIONS ============

        function clearAllData() {
            console.log('üßπ Clearing all cached data...');
            
            // Reset all data arrays
            allItems = [];
            teamMembers = [];
            customItemTypes = {};
            customItemTypeCategories = {};
            
            // Reset counts
            currentItemCount = 0;
            currentMemberCount = 0;
            currentAssignmentCount = 0;
            
            // Reset premium status
            isPremium = false;
            
            // Reset team ID
            userTeamId = null;
            
            // Clear active filters
            activeFilters = {
                search: '',
                category: '',
                type: '',
                number: '',
                size: '',
                color: '',
                season: '',
                condition: '',
                location: ''
            };
            
            console.log('‚úÖ All data cleared');
        }

        // ============ AUTH FUNCTIONS ============

        // Check Auth State
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // Clear all cached data when switching users
                clearAllData();
                
                currentUser = user;
                console.log('‚úÖ User logged in:', user.email);
                await loadUserData();
                showDashboard();
            } else {
                // Clear all data on logout
                clearAllData();
                currentUser = null;
                showLogin();
            }
        });

        // Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            loginBtn.disabled = true;
            loginBtn.textContent = 'Signing in...';
            loginError.style.display = 'none';

            try {
                await auth.signInWithEmailAndPassword(email, password);
                console.log('‚úÖ Login successful');
            } catch (error) {
                console.error('‚ùå Login error:', error);
                loginError.textContent = getErrorMessage(error.code);
                loginError.style.display = 'block';
                loginBtn.disabled = false;
                loginBtn.textContent = 'Sign In';
            }
        });

        // Logout
        logoutBtn.addEventListener('click', async () => {
            try {
                await auth.signOut();
                console.log('‚úÖ Logged out');
            } catch (error) {
                console.error('‚ùå Logout error:', error);
            }
        });

        // Toggle Password Visibility
        togglePassword.addEventListener('click', () => {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                togglePassword.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                togglePassword.textContent = 'üëÅÔ∏è';
            }
        });

        // ============ DATA FUNCTIONS ============

        async function loadUserData() {
            try {
                console.log('üîç Loading user data for UID:', currentUser.uid);
                
                // Load user profile
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                
                console.log('üìÑ User document exists:', userDoc.exists);
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    console.log('üìÑ Full user data:', JSON.stringify(userData, null, 2));

                    // Update UI
                    document.getElementById('user-name').textContent = userData.displayName || currentUser.email.split('@')[0];
                    document.getElementById('user-email').textContent = currentUser.email;
                    
                    // Set avatar initial
                    const initial = (userData.displayName || currentUser.email)[0].toUpperCase();
                    document.getElementById('user-avatar').textContent = initial;

                    // Get user's team FIRST (we need this to check premium in member document)
                    console.log('üèÜ User teamIds:', userData.teamIds);
                    console.log('üèÜ User teamId (legacy):', userData.teamId);
                    
                    if (userData.teamIds && userData.teamIds.length > 0) {
                        userTeamId = userData.teamIds[0];
                        console.log('‚úÖ Using team ID from teamIds array:', userTeamId);
                    } else if (userData.teamId) {
                        // Legacy field - single teamId
                        userTeamId = userData.teamId;
                        console.log('‚úÖ Using legacy team ID:', userTeamId);
                    }

                    // Check Premium Status (after we have userTeamId)
                    await checkPremiumStatus(userData);

                    // Load team data
                    if (userTeamId) {
                        await loadTeamData();
                        await loadInventory();
                        await loadMembers();
                    } else {
                        console.warn('‚ö†Ô∏è No teamIds or teamId found for user');
                        document.getElementById('team-name').textContent = 'No team assigned';
                        document.getElementById('empty-inventory').style.display = 'block';
                        document.getElementById('loading-inventory').style.display = 'none';
                        
                        // Show debug panel
                        showDebugPanel({
                            issue: 'User has no team assigned',
                            uid: currentUser.uid,
                            email: currentUser.email,
                            path: 'users/' + currentUser.uid,
                            suggestion: 'The user document exists but has no teamIds array or teamId field. Please create or join a team through the TeamKitX mobile app.',
                            userData: userData
                        });
                    }
                } else {
                    console.error('‚ùå No user document found in Firestore for UID:', currentUser.uid);
                    document.getElementById('user-name').textContent = currentUser.email.split('@')[0];
                    document.getElementById('user-email').textContent = currentUser.email;
                    document.getElementById('team-name').textContent = 'User profile not found';
                    document.getElementById('empty-inventory').style.display = 'block';
                    document.getElementById('loading-inventory').style.display = 'none';
                    
                    // Show debug panel
                    showDebugPanel({
                        issue: 'No user document found',
                        uid: currentUser.uid,
                        email: currentUser.email,
                        path: 'users/' + currentUser.uid,
                        suggestion: 'This account may not have been created through the TeamKitX app, or the user document was not created properly.'
                    });
                }
            } catch (error) {
                console.error('‚ùå Error loading user data:', error);
                console.error('Error details:', error.message, error.code);
                alert('Error loading user data: ' + error.message);
            }
        }

        async function loadTeamData() {
            try {
                const teamDoc = await db.collection('teams').doc(userTeamId).get();
                
                if (teamDoc.exists) {
                    const teamData = teamDoc.data();
                    document.getElementById('team-name').textContent = teamData.name || 'My Team';
                    console.log('üèÜ Team loaded:', teamData.name);
                }
            } catch (error) {
                console.error('‚ùå Error loading team:', error);
            }
        }

        async function loadInventory() {
            const loadingDiv = document.getElementById('loading-inventory');
            const emptyDiv = document.getElementById('empty-inventory');
            const inventoryList = document.getElementById('inventory-list');

            try {
                console.log('üì¶ Starting inventory load for team:', userTeamId);
                loadingDiv.style.display = 'block';
                emptyDiv.style.display = 'none';
                inventoryList.innerHTML = '';

                // First, load custom item types with their categories
                console.log('üîß Loading custom item types...');
                const customTypesSnapshot = await db.collection('teams')
                    .doc(userTeamId)
                    .collection('customItemTypes')
                    .get();
                
                customTypesSnapshot.forEach(doc => {
                    const type = doc.data();
                    customItemTypes[doc.id] = type.name;
                    customItemTypeCategories[doc.id] = type.category || 'Other';
                });
                console.log('üîß Loaded', Object.keys(customItemTypes).length, 'custom types:', customItemTypes);

                // Query inventory items from team's subcollection (increased limit to 200)
                const itemsSnapshot = await db.collection('teams')
                    .doc(userTeamId)
                    .collection('kitItems')
                    .orderBy('createdAt', 'desc')
                    .limit(200)
                    .get();

                console.log('üì¶ Query completed. Found', itemsSnapshot.size, 'items');
                
                if (itemsSnapshot.size > 0) {
                    console.log('üì¶ First item sample:', itemsSnapshot.docs[0].data());
                }

                if (itemsSnapshot.empty) {
                    loadingDiv.style.display = 'none';
                    emptyDiv.style.display = 'block';
                    updateStats(0, 0, 0);
                    return;
                }

                // Store all items
                allItems = [];
                let totalItems = 0;
                let availableItems = 0;
                let assignedItems = 0;

                itemsSnapshot.forEach(doc => {
                    const item = {
                        id: doc.id,
                        ...doc.data()
                    };
                    allItems.push(item);
                    totalItems++;
                    
                    // Check if item is with player (assigned)
                    if (item.currentLocation === 'with_player') {
                        assignedItems++;
                    } else if (item.currentLocation === 'storage') {
                        availableItems++;
                    }
                });

                // Populate filter dropdowns
                populateFilterDropdowns();

                // Show filter bar
                document.getElementById('filter-bar').style.display = 'block';

                // Render all items initially
                renderFilteredItems(allItems);

                updateStats(totalItems, availableItems, assignedItems);
                loadingDiv.style.display = 'none';

                // Update limits after loading inventory
                checkAndUpdateLimits();

            } catch (error) {
                console.error('‚ùå Error loading inventory:', error);
                loadingDiv.style.display = 'none';
                emptyDiv.style.display = 'block';
                emptyDiv.querySelector('.empty-text').textContent = 'Error loading inventory';
                emptyDiv.querySelector('.empty-subtext').textContent = error.message;
            }
        }

        async function loadMembers() {
            try {
                const membersSnapshot = await db.collection('teams')
                    .doc(userTeamId)
                    .collection('members')
                    .orderBy('name', 'asc')
                    .get();

                teamMembers = [];
                membersSnapshot.forEach(doc => {
                    teamMembers.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                const memberCount = teamMembers.length;
                document.getElementById('total-members').textContent = memberCount;
                console.log('üë• Found', memberCount, 'members:', teamMembers);

                // Update limits after loading members
                checkAndUpdateLimits();
            } catch (error) {
                console.error('‚ùå Error loading members:', error);
            }
        }

        function showMembersModal() {
            const modal = document.getElementById('members-modal');
            const membersList = document.getElementById('members-list');
            
            modal.classList.add('active');
            membersList.innerHTML = '';

            if (teamMembers.length === 0) {
                membersList.innerHTML = '<div class="empty-state"><div class="empty-text">No members found</div></div>';
                return;
            }

            teamMembers.forEach(member => {
                const initial = (member.name || member.displayName || 'U')[0].toUpperCase();
                const roleDisplay = formatRole(member.role);
                
                const card = document.createElement('div');
                card.className = 'member-card';
                card.innerHTML = `
                    <div class="member-header">
                        <div class="member-avatar">${initial}</div>
                        <div class="member-info">
                            <div class="member-name">${member.name || member.displayName || 'Unknown'}</div>
                            <span class="member-role">${roleDisplay}</span>
                        </div>
                    </div>
                    ${member.email ? `<div class="member-email">${member.email}</div>` : ''}
                `;
                membersList.appendChild(card);
            });
        }

        function closeMembersModal() {
            document.getElementById('members-modal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('members-modal');
            if (e.target === modal) {
                closeMembersModal();
            }
        });

        // Close modal with escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeMembersModal();
            }
        });

        // ============ FILTER FUNCTIONS ============

        function populateFilterDropdowns() {
            // Get unique values
            const types = new Set();
            const numbers = new Set();
            const sizes = new Set();
            const colors = new Map(); // Use Map to store hex -> name mapping
            const seasons = new Set();

            allItems.forEach(item => {
                // Item types
                if (item.itemType) {
                    if (item.itemType === 'custom' && item.customItemTypeId && customItemTypes[item.customItemTypeId]) {
                        types.add(customItemTypes[item.customItemTypeId]);
                    } else {
                        types.add(formatItemType(item.itemType));
                    }
                }
                
                // Item numbers
                const itemNumber = extractItemNumber(item.uniqueIdentifier);
                if (itemNumber) numbers.add(itemNumber);
                
                // Sizes
                if (item.size) sizes.add(item.size);
                
                // Colors - convert hex to names and handle multiple colors
                if (item.colorVariant) {
                    // Parse multiple colors
                    let itemColors = [];
                    if (item.colorVariant.includes(',')) {
                        itemColors = item.colorVariant.split(',').map(c => c.trim());
                    } else if (item.colorVariant.includes('/')) {
                        itemColors = item.colorVariant.split('/').map(c => c.trim());
                    } else if (item.colorVariant.includes(' ') && item.colorVariant.startsWith('#')) {
                        itemColors = item.colorVariant.split(' ').map(c => c.trim()).filter(c => c);
                    } else {
                        itemColors = [item.colorVariant];
                    }
                    
                    // Add each color to the set
                    itemColors.forEach(color => {
                        if (color.startsWith('#')) {
                            const colorName = getColorName(color);
                            colors.set(color, colorName);
                        } else {
                            colors.set(color, color);
                        }
                    });
                }
                
                // Seasons
                if (item.season) seasons.add(item.season);
            });

            // Populate dropdowns
            populateDropdown('filter-type', Array.from(types).sort());
            populateDropdown('filter-number', Array.from(numbers).sort((a, b) => parseInt(a) - parseInt(b))); // Numeric sort
            populateDropdown('filter-size', Array.from(sizes).sort());
            populateColorDropdown('filter-color', colors);
            populateDropdown('filter-season', Array.from(seasons).sort((a, b) => b.localeCompare(a))); // Newest first

            console.log('üìä Filter options populated:', { 
                types: types.size,
                numbers: numbers.size,
                sizes: sizes.size, 
                colors: colors.size, 
                seasons: seasons.size 
            });
        }

        function populateColorDropdown(selectId, colorsMap) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            
            // Keep the "All..." option
            const firstOption = select.options[0];
            select.innerHTML = '';
            select.appendChild(firstOption);
            
            // Sort by color name
            const sortedColors = Array.from(colorsMap.entries()).sort((a, b) => 
                a[1].localeCompare(b[1])
            );
            
            // Add color options with colored dots
            sortedColors.forEach(([hexValue, colorName]) => {
                const opt = document.createElement('option');
                opt.value = hexValue;
                opt.textContent = colorName;
                opt.dataset.hex = hexValue;
                select.appendChild(opt);
            });
            
            // Restore previous selection if still valid
            if (currentValue && colorsMap.has(currentValue)) {
                select.value = currentValue;
            }
        }

        function populateDropdown(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            
            // Keep the "All..." option
            const firstOption = select.options[0];
            select.innerHTML = '';
            select.appendChild(firstOption);
            
            // Add options
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                // Add # prefix for number filter
                if (selectId === 'filter-number') {
                    opt.textContent = '#' + option;
                } else {
                    opt.textContent = option;
                }
                select.appendChild(opt);
            });
            
            // Restore previous selection if still valid
            if (currentValue && options.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        function applyFilters() {
            // Get filter values
            activeFilters.search = document.getElementById('search-input').value.toLowerCase();
            activeFilters.category = document.getElementById('filter-category').value;
            activeFilters.type = document.getElementById('filter-type').value;
            activeFilters.number = document.getElementById('filter-number').value;
            activeFilters.size = document.getElementById('filter-size').value;
            activeFilters.color = document.getElementById('filter-color').value;
            activeFilters.season = document.getElementById('filter-season').value;
            activeFilters.condition = document.getElementById('filter-condition').value;
            activeFilters.location = document.getElementById('filter-location').value;

            // Filter items
            let filteredItems = allItems.filter(item => {
                // Search filter
                if (activeFilters.search) {
                    const searchTerm = activeFilters.search;
                    const itemType = item.itemType === 'custom' && item.customItemTypeId && customItemTypes[item.customItemTypeId] 
                        ? customItemTypes[item.customItemTypeId] 
                        : formatItemType(item.itemType);
                    
                    const matchesSearch = 
                        (item.uniqueIdentifier && item.uniqueIdentifier.toLowerCase().includes(searchTerm)) ||
                        (itemType && itemType.toLowerCase().includes(searchTerm)) ||
                        (item.colorVariant && item.colorVariant.toLowerCase().includes(searchTerm)) ||
                        (item.size && item.size.toLowerCase().includes(searchTerm));
                    
                    if (!matchesSearch) return false;
                }

                // Category filter
                if (activeFilters.category) {
                    const itemCategory = getItemCategory(item);
                    if (itemCategory !== activeFilters.category) return false;
                }

                // Type filter
                if (activeFilters.type) {
                    const itemType = item.itemType === 'custom' && item.customItemTypeId && customItemTypes[item.customItemTypeId] 
                        ? customItemTypes[item.customItemTypeId] 
                        : formatItemType(item.itemType);
                    if (itemType !== activeFilters.type) return false;
                }

                // Number filter
                if (activeFilters.number) {
                    const itemNumber = extractItemNumber(item.uniqueIdentifier);
                    if (itemNumber !== activeFilters.number) return false;
                }

                // Size filter
                if (activeFilters.size && item.size !== activeFilters.size) return false;

                // Color filter - match if the item contains this color
                if (activeFilters.color) {
                    const itemHasColor = item.colorVariant && 
                        (item.colorVariant === activeFilters.color || 
                         item.colorVariant.includes(activeFilters.color));
                    if (!itemHasColor) return false;
                }

                // Season filter
                if (activeFilters.season && item.season !== activeFilters.season) return false;

                // Condition filter
                if (activeFilters.condition && item.condition !== activeFilters.condition) return false;

                // Location filter
                if (activeFilters.location && item.currentLocation !== activeFilters.location) return false;

                return true;
            });

            renderFilteredItems(filteredItems);
            updateActiveFilters();
            updateFilterResults(filteredItems.length, allItems.length);
        }

        function renderFilteredItems(items) {
            const inventoryList = document.getElementById('inventory-list');
            const emptyDiv = document.getElementById('empty-inventory');
            
            inventoryList.innerHTML = '';
            
            if (items.length === 0) {
                emptyDiv.style.display = 'block';
                emptyDiv.querySelector('.empty-text').textContent = 'No items match your filters';
                emptyDiv.querySelector('.empty-subtext').textContent = 'Try adjusting your search criteria';
                return;
            }
            
            emptyDiv.style.display = 'none';
            items.forEach(item => renderInventoryCard(item));
        }

        function toggleQuickFilter(filterType) {
            const chip = event.target.closest('.quick-filter-chip');
            
            // Toggle active state
            if (chip.classList.contains('active')) {
                chip.classList.remove('active');
                
                // Clear the corresponding filter
                if (filterType === 'new') {
                    document.getElementById('filter-condition').value = '';
                } else {
                    document.getElementById('filter-location').value = '';
                }
            } else {
                // Remove active from all quick filters
                document.querySelectorAll('.quick-filter-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                
                // Apply the filter
                if (filterType === 'new') {
                    document.getElementById('filter-condition').value = 'new';
                } else {
                    document.getElementById('filter-location').value = filterType;
                }
            }
            
            applyFilters();
        }

        function clearAllFilters() {
            // Clear all filter inputs
            document.getElementById('search-input').value = '';
            document.getElementById('filter-category').value = '';
            document.getElementById('filter-type').value = '';
            document.getElementById('filter-number').value = '';
            document.getElementById('filter-size').value = '';
            document.getElementById('filter-color').value = '';
            document.getElementById('filter-season').value = '';
            document.getElementById('filter-condition').value = '';
            document.getElementById('filter-location').value = '';
            
            // Clear quick filters
            document.querySelectorAll('.quick-filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            
            // Reset active filters
            activeFilters = {
                search: '',
                category: '',
                type: '',
                number: '',
                size: '',
                color: '',
                season: '',
                condition: '',
                location: ''
            };
            
            // Show all items
            renderFilteredItems(allItems);
            updateActiveFilters();
            updateFilterResults(allItems.length, allItems.length);
        }

        function updateActiveFilters() {
            const activeFiltersDiv = document.getElementById('active-filters');
            activeFiltersDiv.innerHTML = '';
            
            let hasActiveFilters = false;
            
            // Search badge
            if (activeFilters.search) {
                hasActiveFilters = true;
                addFilterBadge(activeFiltersDiv, 'Search', `"${activeFilters.search}"`, 'search');
            }
            
            // Other filter badges
            const filterLabels = {
                category: 'Category',
                type: 'Type',
                number: 'Number',
                size: 'Size',
                color: 'Color',
                season: 'Season',
                condition: 'Condition',
                location: 'Location'
            };
            
            Object.entries(activeFilters).forEach(([key, value]) => {
                if (value && key !== 'search') {
                    hasActiveFilters = true;
                    
                    // Format display value
                    let displayValue = value;
                    if (key === 'color' && value.startsWith('#')) {
                        // Convert hex color to name for display
                        displayValue = getColorName(value);
                    } else if (key === 'number') {
                        // Add # prefix for numbers
                        displayValue = '#' + value;
                    }
                    
                    addFilterBadge(activeFiltersDiv, filterLabels[key], displayValue, key);
                }
            });
            
            activeFiltersDiv.style.display = hasActiveFilters ? 'flex' : 'none';
        }

        function addFilterBadge(container, label, value, filterKey) {
            const badge = document.createElement('div');
            badge.className = 'active-filter-badge';
            badge.innerHTML = `
                ${label}: ${value}
                <button class="remove-filter" onclick="removeFilter('${filterKey}')">√ó</button>
            `;
            container.appendChild(badge);
        }

        function removeFilter(filterKey) {
            if (filterKey === 'search') {
                document.getElementById('search-input').value = '';
            } else {
                document.getElementById(`filter-${filterKey}`).value = '';
            }
            
            // Clear quick filter if it matches
            if (filterKey === 'condition' || filterKey === 'location') {
                document.querySelectorAll('.quick-filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
            }
            
            applyFilters();
        }

        function updateFilterResults(filtered, total) {
            const resultsDiv = document.getElementById('filter-results');
            
            if (filtered === total) {
                resultsDiv.innerHTML = `Showing <strong>all ${total}</strong> items`;
            } else {
                resultsDiv.innerHTML = `Showing <strong>${filtered}</strong> of <strong>${total}</strong> items`;
            }
        }

        function renderInventoryCard(item) {
            const inventoryList = document.getElementById('inventory-list');
            
            const card = document.createElement('div');
            card.className = 'inventory-card';
            
            // Get item type - use custom name if it's a custom item
            let itemType = formatItemType(item.itemType);
            if (item.itemType === 'custom' && item.customItemTypeId && customItemTypes[item.customItemTypeId]) {
                itemType = customItemTypes[item.customItemTypeId];
            }
            
            const condition = formatCondition(item.condition);
            const location = formatLocation(item.currentLocation);
            
            // Create color display
            const colorDisplay = formatColorDisplay(item.colorVariant);
            
            // Extract item number from unique identifier (e.g., "CUS-#44-L-024" -> "44")
            const itemNumber = extractItemNumber(item.uniqueIdentifier);
            
            card.innerHTML = `
                <div class="item-header">
                    <div style="flex: 1;">
                        <div class="item-type">${itemType}</div>
                        <div class="item-badges">
                            ${itemNumber ? `<span class="item-number-badge">#${itemNumber}</span>` : ''}
                            <span class="item-size-badge">${item.size || 'N/A'}</span>
                            ${formatColorBadge(item.colorVariant)}
                        </div>
                    </div>
                    <div class="item-condition">${condition}</div>
                </div>
                <div class="item-details">
                    <div class="item-detail">
                        <span class="detail-label">ID</span>
                        <span class="detail-value" style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">${item.uniqueIdentifier || 'N/A'}</span>
                    </div>
                    <div class="item-detail">
                        <span class="detail-label">Season</span>
                        <span class="detail-value">${item.season || 'N/A'}</span>
                    </div>
                    <div class="item-detail" style="grid-column: 1 / -1;">
                        <span class="detail-label">Location</span>
                        <span class="detail-value">${location}</span>
                    </div>
                </div>
            `;
            
            inventoryList.appendChild(card);
        }

        function extractItemNumber(uniqueIdentifier) {
            if (!uniqueIdentifier) return null;
            
            // Try to extract number from patterns like:
            // "CUS-#44-L-024" -> "44"
            // "#31-M-023" -> "31"
            // "CUS-31-L-024" -> "31"
            
            const match = uniqueIdentifier.match(/#?(\d+)/);
            return match ? match[1] : null;
        }

        function getItemCategory(item) {
            // If it's a custom item type, get category from customItemTypeCategories
            if (item.itemType === 'custom' && item.customItemTypeId) {
                return customItemTypeCategories[item.customItemTypeId] || 'Other';
            }
            
            // Map standard item types to categories
            const itemType = item.itemType;
            switch(itemType) {
                case 'jersey':
                case 'shorts':
                case 'socks':
                    return 'Game Kits';
                case 'trainingShirt':
                case 'tracksuit':
                case 'bibs':
                    return 'Training';
                case 'goalkeepingKit':
                case 'gloves':
                    return 'Goalkeeper';
                case 'balls':
                case 'cones':
                case 'protectiveGear':
                    return 'Equipment';
                case 'boots':
                    return 'Accessories';
                default:
                    return 'Other';
            }
        }

        function formatColorBadge(colorVariant) {
            if (!colorVariant) return '';
            
            // Parse multiple colors - could be comma-separated, slash-separated, or space-separated
            let colors = [];
            
            // Check for multiple hex codes or color names
            if (colorVariant.includes(',')) {
                colors = colorVariant.split(',').map(c => c.trim());
            } else if (colorVariant.includes('/')) {
                colors = colorVariant.split('/').map(c => c.trim());
            } else if (colorVariant.includes(' ') && colorVariant.startsWith('#')) {
                // Multiple hex codes separated by space
                colors = colorVariant.split(' ').map(c => c.trim()).filter(c => c);
            } else {
                colors = [colorVariant];
            }
            
            // Create color dots
            let colorDotsHTML = '';
            colors.forEach(color => {
                if (color.startsWith('#')) {
                    colorDotsHTML += `<div class="color-dot" style="background-color: ${color}; width: 20px; height: 20px;"></div>`;
                }
            });
            
            return colorDotsHTML;
        }

        function formatColorDisplay(colorVariant) {
            if (!colorVariant) return 'N/A';
            
            // Parse multiple colors
            let colors = [];
            
            if (colorVariant.includes(',')) {
                colors = colorVariant.split(',').map(c => c.trim());
            } else if (colorVariant.includes('/')) {
                colors = colorVariant.split('/').map(c => c.trim());
            } else if (colorVariant.includes(' ') && colorVariant.startsWith('#')) {
                colors = colorVariant.split(' ').map(c => c.trim()).filter(c => c);
            } else {
                colors = [colorVariant];
            }
            
            // If all colors are hex codes, show dots with names
            if (colors.every(c => c.startsWith('#'))) {
                let colorNames = colors.map(c => getColorName(c)).join(', ');
                let colorDotsHTML = colors.map(c => 
                    `<div class="color-dot" style="background-color: ${c};"></div>`
                ).join('');
                
                return `<div class="color-bubble">
                    ${colorDotsHTML}
                    <span class="color-name">${colorNames}</span>
                </div>`;
            }
            
            // If it's just color names, return as is
            return colorVariant;
        }

        function getColorName(hexColor) {
            // Common color names mapping
            const colorNames = {
                '#000000': 'Black',
                '#FFFFFF': 'White',
                '#FF0000': 'Red',
                '#00FF00': 'Green',
                '#0000FF': 'Blue',
                '#FFFF00': 'Yellow',
                '#FF00FF': 'Magenta',
                '#00FFFF': 'Cyan',
                '#FFA500': 'Orange',
                '#800080': 'Purple',
                '#FFC0CB': 'Pink',
                '#A52A2A': 'Brown',
                '#808080': 'Gray',
                '#C0C0C0': 'Silver',
                '#FFD700': 'Gold',
                '#000080': 'Navy',
                '#008080': 'Teal',
                '#CCFF00': 'Lime'
            };
            
            const upperHex = hexColor.toUpperCase();
            
            // Check for exact match
            if (colorNames[upperHex]) {
                return colorNames[upperHex];
            }
            
            // For other colors, try to determine based on RGB values
            const hex = upperHex.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            // Simple color categorization
            if (r === 0 && g === 0 && b === 0) return 'Black';
            if (r === 255 && g === 255 && b === 255) return 'White';
            if (r > 200 && g < 100 && b < 100) return 'Red';
            if (r < 100 && g > 200 && b < 100) return 'Green';
            if (r < 100 && g < 100 && b > 200) return 'Blue';
            if (r > 200 && g > 200 && b < 100) return 'Yellow';
            if (r > 200 && g > 100 && b < 100) return 'Orange';
            if (r > 100 && g < 100 && b > 200) return 'Purple';
            if (r > 200 && g < 100 && b > 200) return 'Pink';
            if (r < 100 && g > 100 && b > 200) return 'Cyan';
            if (Math.abs(r - g) < 30 && Math.abs(g - b) < 30 && Math.abs(r - b) < 30) {
                if (r < 100) return 'Dark Gray';
                if (r > 180) return 'Light Gray';
                return 'Gray';
            }
            
            // Default: return hex code without #
            return hexColor;
        }

        function updateStats(total, available, assigned) {
            document.getElementById('total-items').textContent = total;
            document.getElementById('available-items').textContent = available;
            document.getElementById('assigned-items').textContent = assigned;
        }

        // ============ DEBUG FUNCTIONS ============

        function showDebugPanel(data) {
            const panel = document.getElementById('debug-panel');
            const content = document.getElementById('debug-content');
            
            content.innerHTML = `
                <p><strong>Issue:</strong> ${data.issue}</p>
                <p><strong>UID:</strong> ${data.uid}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Firebase Path:</strong> ${data.path}</p>
                <hr style="margin: 12px 0; opacity: 0.3;">
                <p><strong>Suggestion:</strong></p>
                <p style="font-size: 0.8rem;">${data.suggestion}</p>
                ${data.userData ? `<hr style="margin: 12px 0; opacity: 0.3;"><p><strong>User Data:</strong></p><pre>${JSON.stringify(data.userData, null, 2)}</pre>` : ''}
            `;
            
            panel.style.display = 'block';
        }

        // ============ HELPER FUNCTIONS ============

        function formatItemType(type) {
            if (!type) return 'Unknown';
            return type.replace(/_/g, ' ').split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
            ).join(' ');
        }

        function formatCondition(condition) {
            const conditions = {
                'new': '‚ú® New',
                'excellent': 'üíö Excellent',
                'good': 'üëç Good',
                'fair': '‚ö†Ô∏è Fair',
                'poor': 'üî¥ Poor',
                'damaged': 'üíî Damaged',
                'beyond_repair': '‚ùå Beyond Repair'
            };
            return conditions[condition] || condition || 'Unknown';
        }

        function formatLocation(location) {
            const locations = {
                'storage': 'üè† Storage',
                'with_player': 'üë§ With Player',
                'being_washed': 'üíß Being Washed',
                'being_repaired': 'üîß Being Repaired',
                'in_transit': 'üöö In Transit',
                'lost': '‚ùå Lost',
                'disposed': 'üóëÔ∏è Disposed'
            };
            return locations[location] || location || 'Unknown';
        }

        function formatRole(role) {
            const roles = {
                'admin': 'Admin',
                'player': 'Player',
                'coach': 'Coach',
                'assistant': 'Assistant',
                'manager': 'Manager',
                'physio': 'Physio',
                'doctor': 'Doctor',
                'kit_manager': 'Kit Manager',
                'analyst': 'Analyst',
                'nutritionist': 'Nutritionist'
            };
            return roles[role] || role || 'Member';
        }

        function getErrorMessage(errorCode) {
            const errors = {
                'auth/invalid-email': 'Invalid email address',
                'auth/user-disabled': 'This account has been disabled',
                'auth/user-not-found': 'No account found with this email',
                'auth/wrong-password': 'Incorrect password',
                'auth/invalid-credential': 'Invalid email or password',
                'auth/too-many-requests': 'Too many failed attempts. Try again later'
            };
            return errors[errorCode] || 'Login failed. Please try again.';
        }

        function showLogin() {
            loginScreen.style.display = 'flex';
            dashboard.style.display = 'none';
        }

        function showDashboard() {
            loginScreen.style.display = 'none';
            dashboard.style.display = 'block';
        }

        // Forgot Password
        document.getElementById('forgot-password-link').addEventListener('click', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            
            if (!email) {
                alert('Please enter your email address first');
                return;
            }

            try {
                await auth.sendPasswordResetEmail(email);
                alert('Password reset email sent! Check your inbox.');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // ============ PREMIUM & SUBSCRIPTION FUNCTIONS ============

        async function checkPremiumStatus(userData) {
            try {
                console.log('üíé Checking premium status...');
                console.log('üíé User data received:', userData);
                console.log('üíé Current userTeamId:', userTeamId);
                
                // PRIMARY CHECK: Check team member document FIRST (this is where premium is stored!)
                if (userTeamId && currentUser) {
                    console.log('üíé Checking member document at: teams/' + userTeamId + '/members/' + currentUser.uid);
                    
                    const memberDoc = await db.collection('teams')
                        .doc(userTeamId)
                        .collection('members')
                        .doc(currentUser.uid)
                        .get();
                    
                    if (memberDoc.exists) {
                        const memberData = memberDoc.data();
                        console.log('üë§ Member document exists! Data:', memberData);
                        console.log('üë§ teamKitXPremium:', memberData.teamKitXPremium);
                        console.log('üë§ teamWalletXPremium:', memberData.teamWalletXPremium);
                        
                        // Check TeamKitX premium at member level
                        if (memberData.teamKitXPremium === true) {
                            isPremium = true;
                            console.log('‚úÖ TeamKitX Premium access from member document!');
                            updatePremiumUI(true);
                            return;
                        }
                        
                        if (memberData.hasPremiumAccess === true) {
                            isPremium = true;
                            console.log('‚úÖ Premium access (hasPremiumAccess) from member document');
                            updatePremiumUI(true);
                            return;
                        }
                    } else {
                        console.log('‚ö†Ô∏è Member document does not exist');
                    }
                }
                
                // SECONDARY CHECK: Check user document
                console.log('üíé User doc - teamKitXPremium:', userData.teamKitXPremium);
                console.log('üíé User doc - hasPremiumAccess:', userData.hasPremiumAccess);
                
                if (userData.teamKitXPremium === true) {
                    isPremium = true;
                    console.log('‚úÖ TeamKitX Premium access granted from user document');
                    updatePremiumUI(true);
                    return;
                }

                // Check legacy field names for backwards compatibility
                if (userData.hasPremiumAccess === true) {
                    isPremium = true;
                    console.log('‚úÖ Manual premium access granted (legacy field)');
                    updatePremiumUI(true);
                    return;
                }

                // Check subscription tier
                const subscriptionDoc = await db.collection('subscriptions')
                    .doc(currentUser.uid)
                    .get();
                
                if (subscriptionDoc.exists) {
                    const subData = subscriptionDoc.data();
                    console.log('üìÑ Subscription data:', subData);
                    if (subData.tier === 'premium' && subData.isActive) {
                        isPremium = true;
                        console.log('‚úÖ Active premium subscription found');
                        updatePremiumUI(true);
                        return;
                    }
                }

                // Default to free tier
                isPremium = false;
                console.log('üì¶ Free tier user - no premium indicators found');
                updatePremiumUI(false);
                
            } catch (error) {
                console.error('‚ùå Error checking premium status:', error);
                isPremium = false;
                updatePremiumUI(false);
            }
        }

        function updatePremiumUI(premium) {
            const badge = document.getElementById('premium-badge');
            if (premium) {
                badge.innerHTML = '<span class="premium-badge">üëë PREMIUM</span>';
            } else {
                badge.innerHTML = '<span class="free-badge">FREE</span>';
            }
        }

        function checkAndUpdateLimits() {
            // Update counts
            currentItemCount = allItems.length;
            currentMemberCount = teamMembers.length;
            currentAssignmentCount = allItems.filter(item => item.assignedTo).length;

            console.log(`üìä Current counts: ${currentItemCount} items, ${currentMemberCount} members, ${currentAssignmentCount} assignments`);

            // Update buttons
            const btnAddItem = document.getElementById('btn-add-item');
            const btnNumberedSet = document.getElementById('btn-create-numbered-set');
            const btnAddMember = document.getElementById('btn-add-member');
            const btnCreateAssignment = document.getElementById('btn-create-assignment');

            if (!isPremium) {
                // Check item limit
                if (currentItemCount >= FREE_TIER_LIMITS.items) {
                    btnAddItem.disabled = true;
                    btnAddItem.title = `Free tier limit: ${FREE_TIER_LIMITS.items} items`;
                } else {
                    btnAddItem.disabled = false;
                    btnAddItem.title = '';
                }

                // Numbered set creator - Premium only
                btnNumberedSet.disabled = true;
                btnNumberedSet.title = 'Premium Feature - Upgrade to create numbered sets';

                // Check member limit
                if (currentMemberCount >= FREE_TIER_LIMITS.members) {
                    btnAddMember.disabled = true;
                    btnAddMember.title = `Free tier limit: ${FREE_TIER_LIMITS.members} members`;
                } else {
                    btnAddMember.disabled = false;
                    btnAddMember.title = '';
                }

                // Check assignment limit
                if (currentAssignmentCount >= FREE_TIER_LIMITS.assignments) {
                    btnCreateAssignment.disabled = true;
                    btnCreateAssignment.title = `Free tier limit: ${FREE_TIER_LIMITS.assignments} assignments`;
                } else {
                    btnCreateAssignment.disabled = false;
                    btnCreateAssignment.title = '';
                }
            } else {
                // Premium: enable all
                btnAddItem.disabled = false;
                btnNumberedSet.disabled = false;
                btnNumberedSet.title = 'Create numbered sets (e.g., Jerseys #1-25)';
                btnAddMember.disabled = false;
                btnCreateAssignment.disabled = false;
            }
        }

        // ============ MODAL FUNCTIONS ============

        function showAddItemModal() {
            // Check limits
            if (!isPremium && currentItemCount >= FREE_TIER_LIMITS.items) {
                document.getElementById('item-limit-warning').style.display = 'flex';
                document.getElementById('current-item-count').textContent = currentItemCount;
                document.getElementById('submit-item-btn').disabled = true;
            } else {
                document.getElementById('item-limit-warning').style.display = 'none';
                document.getElementById('submit-item-btn').disabled = false;
            }
            document.getElementById('add-item-modal').classList.add('active');
        }

        function closeAddItemModal() {
            document.getElementById('add-item-modal').classList.remove('active');
            document.getElementById('add-item-form').reset();
        }

        function showAddMemberModal() {
            // Check limits
            if (!isPremium && currentMemberCount >= FREE_TIER_LIMITS.members) {
                document.getElementById('member-limit-warning').style.display = 'flex';
                document.getElementById('current-member-count').textContent = currentMemberCount;
                document.getElementById('submit-member-btn').disabled = true;
            } else {
                document.getElementById('member-limit-warning').style.display = 'none';
                document.getElementById('submit-member-btn').disabled = false;
            }
            document.getElementById('add-member-modal').classList.add('active');
        }

        function closeAddMemberModal() {
            document.getElementById('add-member-modal').classList.remove('active');
            document.getElementById('add-member-form').reset();
        }

        function showCreateAssignmentModal() {
            // Check if we have items and members
            const availableItems = allItems.filter(item => !item.assignedTo && !item.isAssigned);
            
            if (availableItems.length === 0) {
                alert('‚ö†Ô∏è No available items to assign! Please add items first.');
                return;
            }
            
            if (teamMembers.length === 0) {
                alert('‚ö†Ô∏è No team members found! Please add team members first.');
                return;
            }
            
            // Check limits
            if (!isPremium && currentAssignmentCount >= FREE_TIER_LIMITS.assignments) {
                document.getElementById('assignment-limit-warning').style.display = 'flex';
                document.getElementById('current-assignment-count').textContent = currentAssignmentCount;
                document.getElementById('submit-assignment-btn').disabled = true;
            } else {
                document.getElementById('assignment-limit-warning').style.display = 'none';
                document.getElementById('submit-assignment-btn').disabled = false;
            }

            // Populate item dropdown (only available items)
            const itemSelect = document.getElementById('assignment-item');
            itemSelect.innerHTML = '<option value="">Choose an item...</option>';
            availableItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                
                // Build display text with number if available
                const itemNumber = extractItemNumber(item.uniqueIdentifier);
                const displayName = getDisplayName(item);
                const size = item.size || 'N/A';
                
                if (itemNumber) {
                    option.textContent = `#${itemNumber} - ${displayName} - ${size}`;
                } else {
                    option.textContent = `${displayName} - ${size}`;
                }
                
                itemSelect.appendChild(option);
            });

            // Populate member dropdown
            const memberSelect = document.getElementById('assignment-member');
            memberSelect.innerHTML = '<option value="">Choose a member...</option>';
            teamMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.displayName || member.name || member.email;
                memberSelect.appendChild(option);
            });

            document.getElementById('create-assignment-modal').classList.add('active');
        }

        function closeCreateAssignmentModal() {
            document.getElementById('create-assignment-modal').classList.remove('active');
            document.getElementById('create-assignment-form').reset();
        }

        function showNumberedSetModal() {
            // Check if premium
            if (!isPremium) {
                document.getElementById('numbered-set-premium-warning').style.display = 'flex';
                document.getElementById('submit-numbered-set-btn').disabled = true;
                alert('üëë Premium Feature\n\nNumbered Set Creator is a Premium feature that allows you to create multiple numbered items at once (e.g., Jerseys #1-25).\n\nUpgrade to Premium to unlock this feature!');
                return;
            } else {
                document.getElementById('numbered-set-premium-warning').style.display = 'none';
                document.getElementById('submit-numbered-set-btn').disabled = false;
            }
            
            updateItemCount();
            document.getElementById('numbered-set-modal').classList.add('active');
        }

        function closeNumberedSetModal() {
            document.getElementById('numbered-set-modal').classList.remove('active');
            document.getElementById('numbered-set-form').reset();
            document.getElementById('sequential-mode').style.display = 'flex';
            document.getElementById('custom-mode').style.display = 'none';
        }

        function updateNumberingMode() {
            const mode = document.getElementById('set-numbering-mode').value;
            if (mode === 'sequential') {
                document.getElementById('sequential-mode').style.display = 'flex';
                document.getElementById('custom-mode').style.display = 'none';
            } else {
                document.getElementById('sequential-mode').style.display = 'none';
                document.getElementById('custom-mode').style.display = 'block';
            }
            updateItemCount();
        }

        function updateItemCount() {
            const mode = document.getElementById('set-numbering-mode').value;
            let count = 0;
            
            if (mode === 'sequential') {
                const start = parseInt(document.getElementById('set-start-number').value) || 1;
                const end = parseInt(document.getElementById('set-end-number').value) || 25;
                count = Math.max(0, end - start + 1);
            } else {
                const customNumbers = document.getElementById('set-custom-numbers').value;
                if (customNumbers) {
                    count = customNumbers.split(',').filter(n => n.trim() !== '').length;
                }
            }
            
            document.getElementById('set-item-count').textContent = count;
        }

        // Add event listeners to update count
        document.addEventListener('DOMContentLoaded', () => {
            const startInput = document.getElementById('set-start-number');
            const endInput = document.getElementById('set-end-number');
            const customInput = document.getElementById('set-custom-numbers');
            
            if (startInput) startInput.addEventListener('input', updateItemCount);
            if (endInput) endInput.addEventListener('input', updateItemCount);
            if (customInput) customInput.addEventListener('input', updateItemCount);
        });

        // ============ FORM SUBMISSION HANDLERS ============

        async function handleAddItem(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submit-item-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Adding...';

            try {
                // Basic Info
                const itemType = document.getElementById('item-type').value;
                const itemNumber = document.getElementById('item-number').value;
                const itemSize = document.getElementById('item-size').value;
                const itemColor = document.getElementById('item-color').value;
                
                // Purchase Info
                const purchasePrice = document.getElementById('item-purchase-price').value;
                const supplier = document.getElementById('item-supplier').value;
                
                // Identification
                const itemSeason = document.getElementById('item-season').value;
                const customUniqueId = document.getElementById('item-unique-id').value;
                
                // Status & Location
                const itemCondition = document.getElementById('item-condition').value;
                const itemLocation = document.getElementById('item-location').value;
                
                // Notes
                const itemNotes = document.getElementById('item-notes').value;

                // Generate unique identifier (use custom if provided, otherwise auto-generate)
                let uniqueIdentifier;
                if (customUniqueId && customUniqueId.trim() !== '') {
                    uniqueIdentifier = customUniqueId.trim();
                } else {
                    const typePrefix = itemType.substring(0, 3).toUpperCase();
                    const numberPart = itemNumber ? `#${itemNumber}` : `#${Date.now().toString().slice(-4)}`;
                    const sizePart = itemSize !== 'one_size' ? itemSize : 'OS';
                    const randomPart = Math.random().toString(36).substring(2, 5).toUpperCase();
                    uniqueIdentifier = `${typePrefix}-${numberPart}-${sizePart}-${randomPart}`;
                }

                const newItem = {
                    // Basic Info
                    itemType: itemType,
                    uniqueIdentifier: uniqueIdentifier,
                    size: itemSize,
                    colorVariant: itemColor,
                    
                    // Purchase Info
                    purchasePrice: purchasePrice ? parseFloat(purchasePrice) : 0,
                    supplierInfo: supplier,
                    
                    // Identification
                    season: itemSeason || null,
                    tags: itemNumber ? [`Number: ${itemNumber}`] : [],
                    
                    // Status & Location
                    condition: itemCondition,
                    currentLocation: itemLocation,
                    
                    // Notes
                    notes: itemNotes || null,
                    
                    // Assignment
                    isAssigned: false,
                    assignedTo: null,
                    assignmentHistory: [],
                    
                    // Metadata
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };

                console.log('üì¶ Adding new item:', newItem);

                // Add to Firestore
                await db.collection('teams')
                    .doc(userTeamId)
                    .collection('kitItems')
                    .add(newItem);

                console.log('‚úÖ Item added successfully');
                alert('‚úÖ Item added successfully!');
                
                closeAddItemModal();
                await loadInventory(); // Reload inventory
                checkAndUpdateLimits(); // Update limits

            } catch (error) {
                console.error('‚ùå Error adding item:', error);
                alert('Error adding item: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Item';
            }
        }

        async function handleAddMember(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submit-member-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Adding...';

            try {
                const memberName = document.getElementById('member-name').value;
                const memberEmail = document.getElementById('member-email').value;
                const memberRole = document.getElementById('member-role').value;
                const memberNumber = document.getElementById('member-number').value;

                const newMember = {
                    displayName: memberName,
                    email: memberEmail,
                    role: memberRole,
                    playerNumber: memberNumber ? parseInt(memberNumber) : null,
                    joinedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    addedBy: currentUser.uid,
                    status: 'pending', // User hasn't joined yet
                    hasPremiumAccess: false
                };

                console.log('üë§ Adding new member:', newMember);

                // Check if user exists
                const usersQuery = await db.collection('users')
                    .where('email', '==', memberEmail)
                    .limit(1)
                    .get();

                let userId;
                if (!usersQuery.empty) {
                    // User exists
                    userId = usersQuery.docs[0].id;
                    newMember.status = 'active';
                } else {
                    // User doesn't exist yet - create placeholder with email as ID
                    userId = memberEmail.replace(/[^a-zA-Z0-9]/g, '_');
                }

                // Add to team members collection
                await db.collection('teams')
                    .doc(userTeamId)
                    .collection('members')
                    .doc(userId)
                    .set(newMember);

                // Update team member count
                await db.collection('teams')
                    .doc(userTeamId)
                    .update({
                        memberCount: firebase.firestore.FieldValue.increment(1),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                console.log('‚úÖ Member added successfully');
                alert('‚úÖ Member added successfully!');
                
                closeAddMemberModal();
                await loadMembers(); // Reload members
                checkAndUpdateLimits(); // Update limits

            } catch (error) {
                console.error('‚ùå Error adding member:', error);
                alert('Error adding member: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Member';
            }
        }

        async function handleCreateAssignment(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submit-assignment-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating...';

            try {
                const itemId = document.getElementById('assignment-item').value;
                const memberId = document.getElementById('assignment-member').value;
                const notes = document.getElementById('assignment-notes').value;

                console.log('üîÑ Creating assignment:', { itemId, memberId, notes });

                // Update item with assignment
                await db.collection('teams')
                    .doc(userTeamId)
                    .collection('kitItems')
                    .doc(itemId)
                    .update({
                        isAssigned: true,
                        assignedTo: memberId,
                        assignedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        assignmentNotes: notes || null,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        assignmentHistory: firebase.firestore.FieldValue.arrayUnion({
                            assignedTo: memberId,
                            assignedAt: new Date().toISOString(),
                            assignedBy: currentUser.uid,
                            notes: notes || null
                        })
                    });

                console.log('‚úÖ Assignment created successfully');
                alert('‚úÖ Assignment created successfully!');
                
                closeCreateAssignmentModal();
                await loadInventory(); // Reload inventory
                checkAndUpdateLimits(); // Update limits

            } catch (error) {
                console.error('‚ùå Error creating assignment:', error);
                alert('Error creating assignment: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Create Assignment';
            }
        }

        async function handleCreateNumberedSet(event) {
            event.preventDefault();
            
            // Premium check
            if (!isPremium) {
                alert('üëë Premium Feature\n\nPlease upgrade to Premium to use the Numbered Set Creator.');
                return;
            }
            
            const submitBtn = document.getElementById('submit-numbered-set-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating items...';

            try {
                const mode = document.getElementById('set-numbering-mode').value;
                const itemType = document.getElementById('set-item-type').value;
                const size = document.getElementById('set-size').value;
                const color = document.getElementById('set-color').value;
                const condition = document.getElementById('set-condition').value;
                const location = document.getElementById('set-location').value;
                const season = document.getElementById('set-season').value;
                const supplier = document.getElementById('set-supplier').value;
                const notes = document.getElementById('set-notes').value;

                // Get numbers to create
                let numbers = [];
                if (mode === 'sequential') {
                    const start = parseInt(document.getElementById('set-start-number').value);
                    const end = parseInt(document.getElementById('set-end-number').value);
                    
                    if (start > end) {
                        alert('Start number must be less than or equal to end number');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Create Numbered Set';
                        return;
                    }
                    
                    for (let i = start; i <= end; i++) {
                        numbers.push(i);
                    }
                } else {
                    const customNumbersStr = document.getElementById('set-custom-numbers').value;
                    numbers = customNumbersStr.split(',')
                        .map(n => parseInt(n.trim()))
                        .filter(n => !isNaN(n) && n >= 0);
                    
                    if (numbers.length === 0) {
                        alert('Please enter valid numbers');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Create Numbered Set';
                        return;
                    }
                }

                console.log(`üî¢ Creating ${numbers.length} numbered items:`, numbers);

                // Create items one by one
                let createdCount = 0;
                for (const number of numbers) {
                    const typePrefix = itemType.substring(0, 3).toUpperCase();
                    const numberPart = `#${number}`;
                    const sizePart = size !== 'one_size' ? size : 'OS';
                    const randomPart = Math.random().toString(36).substring(2, 5).toUpperCase();
                    const uniqueIdentifier = `${typePrefix}-${numberPart}-${sizePart}-${randomPart}`;

                    const newItem = {
                        // Basic Info
                        itemType: itemType,
                        uniqueIdentifier: uniqueIdentifier,
                        size: size,
                        colorVariant: color,
                        
                        // Purchase Info
                        purchasePrice: 0,
                        supplierInfo: supplier,
                        
                        // Identification
                        season: season || null,
                        tags: [`Number: ${number}`, `NumberedSet: ${numbers[0]}-${numbers[numbers.length-1]}`],
                        
                        // Status & Location
                        condition: condition,
                        currentLocation: location,
                        
                        // Notes
                        notes: notes || null,
                        
                        // Assignment
                        isAssigned: false,
                        assignedTo: null,
                        assignmentHistory: [],
                        
                        // Metadata
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        createdBy: currentUser.uid
                    };

                    await db.collection('teams')
                        .doc(userTeamId)
                        .collection('kitItems')
                        .add(newItem);

                    createdCount++;
                    submitBtn.textContent = `Creating... ${createdCount}/${numbers.length}`;
                }

                console.log(`‚úÖ Created ${createdCount} items successfully`);
                alert(`‚úÖ Successfully created ${createdCount} numbered items!`);
                
                closeNumberedSetModal();
                await loadInventory(); // Reload inventory
                checkAndUpdateLimits(); // Update limits

            } catch (error) {
                console.error('‚ùå Error creating numbered set:', error);
                alert('Error creating numbered set: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Create Numbered Set';
            }
        }

        // Helper function to get display name for items
        function getDisplayName(item) {
            if (item.customItemTypeId && customItemTypes[item.customItemTypeId]) {
                return customItemTypes[item.customItemTypeId];
            }
            
            const typeNames = {
                // Game Kits
                'jersey': 'üëï Jersey',
                'shorts': 'ü©≥ Shorts',
                'socks': 'üß¶ Socks',
                // Training
                'training_shirt': 'üèÉ Training Shirt',
                'training_jersey': 'üèÉ Training Jersey', // Legacy
                'bibs': 'üü¶ Bibs',
                'tracksuit': 'üß• Tracksuit',
                'balls': '‚öΩ Balls',
                'ball': '‚öΩ Ball', // Legacy
                'cones': 'üî∂ Cones',
                'cone': 'üî∂ Cone', // Legacy
                // Goalkeeper
                'goalkeeping_kit': 'ü•Ö Goalkeeping Kit',
                'goalkeeper_jersey': 'ü•Ö GK Jersey', // Legacy
                'gloves': 'üß§ Gloves',
                'goalkeeper_gloves': 'üß§ GK Gloves', // Legacy
                // Equipment & Accessories
                'boots': 'üëü Boots',
                'protective_gear': 'üõ°Ô∏è Protective Gear',
                // Other
                'other': 'üì¶ Other',
                'medical_kit': 'üè• Medical Kit', // Legacy
                'bag': 'üéí Bag', // Legacy
                'training_bib': 'üü¶ Training Bib' // Legacy
            };
            
            return typeNames[item.itemType] || item.itemType || 'Unknown';
        }

    </script>
</body>
</html>

